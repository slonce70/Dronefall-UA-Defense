<!doctype html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dronefall: UA Defense</title>
    <meta name="theme-color" content="#0b0b0b" />
    <!-- –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ —Å—Ç–∏–ª—ñ: —Ç–µ–º–Ω–∏–π —Ñ–æ–Ω + –ø–æ–∫—Ä–∏—Ç—Ç—è preMenu —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ ¬´–±—ñ–ª–æ—ó¬ª –≤—Å–ø–∏—à–∫–∏ -->
    <style>
      html,body{margin:0;height:100%;background:#0b0b0b}
      #preMenu{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#0b0b0b;z-index:1000}
      #preMenu .overlay{position:absolute;inset:0;background:rgba(0,0,0,.6)}
    </style>
    <!-- Preload —à–ø–∞–ª–µ—Ä —Ç–∏—Ç—É–ª—å–Ω–æ–≥–æ –µ–∫—Ä–∞–Ω—É –¥–ª—è —à–≤–∏–¥—à–æ–≥–æ –ø–µ—Ä—à–æ–≥–æ –∫–∞–¥—Ä—É -->
    <link rel="preload" as="image" href="/assets/wallpaper.png" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <link rel="icon" type="image/png" href="/assets/favicon.png" />
    <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ CSS –æ–¥—Ä–∞–∑—É, –±–µ–∑ JS‚Äë—ñ–Ω º—î–∫—Ü—ñ—ó, —â–æ–± —É–Ω–∏–∫–∞—Ç–∏ –º–∏–≥–æ—Ç—ñ–Ω–Ω—è –≤ dev -->
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/footer.css" />
    <!-- Leaflet –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ NPM (–¥–∏–≤. src/main.js) -->
  </head>
  <body>
    <div id="map"></div>

    <div id="controlPanel">
      <span id="dragHandle"></span>
      <div class="panel-body">
        <span id="money">üí∂ 3500</span>
        <span id="waveDisplay">üåä 0</span>
        <span id="scoreDisplay">üéØ 0</span>
      </div>
    </div>

    <div id="soundButtonContainer">
      <div id="speedButtons" role="group" aria-label="–ö–µ—Ä—É–≤–∞–Ω–Ω—è —à–≤–∏–¥–∫—ñ—Å—Ç—é">
        <button id="speed1x" class="speed-button active" aria-label="–®–≤–∏–¥–∫—ñ—Å—Ç—å 1x">1x</button>
        <button id="speed2x" class="speed-button" aria-label="–®–≤–∏–¥–∫—ñ—Å—Ç—å 2x">2x</button>
        <button id="speed3x" class="speed-button" aria-label="–®–≤–∏–¥–∫—ñ—Å—Ç—å 3x">3x</button>
      </div>
      <div id="settingsButtons">
        <button id="pauseButton" aria-label="–ü–∞—É–∑–∞">‚è∏Ô∏è</button>
        <button id="soundButton" aria-label="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫">üîä</button>
      </div>
    </div>

    <audio id="bgMusic" loop src="assets/music.mp3" playsinline preload="none"></audio>
    <audio id="alarmSound" src="assets/alarm.mp3" playsinline preload="auto"></audio>

    <div id="preMenu">
      <div class="overlay"></div>
      <div class="preMenu-content" role="dialog" aria-modal="true" aria-labelledby="gameTitle">
        <span class="ai-note"
          >üß† –¶—è –≥—Ä–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —à—Ç—É—á–Ω–æ–≥–æ —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É.<br />¬© 2025 DroneFall v.1.8.22</span
        >
        <h1 id="gameTitle">Dronefall: UA Defense</h1>
        <div class="button-group compact">
          <button id="startBtn" class="mode-button small">
            –†–µ–∂–∏–º:<br />üîÑÔ∏è –ö—Ä—É–≥–æ–≤–∞<br />–æ–±–æ—Ä–æ–Ω–∞
          </button>
          <button id="startRightBtn" class="mode-button small">
            –†–µ–∂–∏–º:<br />‚û°Ô∏è –ü—Ä–æ—Ç–∏<br />—Ä–æ—Å—ñ—ó
          </button>
        </div>
        <div class="button-group compact" style="margin-top: 0px">
          <button id="startHardcoreBtn" class="mode-button small">–†–µ–∂–∏–º:<br />üî• –•–∞—Ä–¥–∫–æ—Ä</button>

          <button id="startCrtv" class="mode-button small">‚åõ –ù–µ–∑–∞–±–∞—Ä–æ–º...</button>
        </div>

        <div id="legend">
          üí∂ –ì—Ä–æ—à—ñ - –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ü–ü–û.<br />
          üåä –•–≤–∏–ª—è - –Ω–æ–º–µ—Ä –∞—Ç–∞–∫–∏.<br />
          üéØ –†–∞—Ö—É–Ω–æ–∫ - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–Ω–∏—â–µ–Ω–∏—Ö —Ü—ñ–ª–µ–π.
        </div>
        <button
          class="donate-btn"
          onclick="(function(){var w=window.open('https://send.monobank.ua/jar/2JbpBYkhMv','_blank'); if(w) w.opener=null;})()"
        >
          üíô –î–æ–Ω–∞—Ç –Ω–∞ –ó–°–£
        </button>
        <button
          class="donate-btn"
          onclick="(function(){var w=window.open('https://send.monobank.ua/jar/z1H8hEA96','_blank'); if(w) w.opener=null;})()"
        >
          üíõ –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç
        </button>
        <div class="footer-links">
          <a href="https://t.me/dronefall" target="_blank" rel="noopener noreferrer">
            <img src="assets/telegram-icon.png" alt="–¢–µ–ª–µ–≥—Ä–∞–º" />
          </a>
          <a href="https://tiktok.com/@eurogames7" target="_blank" rel="noopener noreferrer">
            <img src="assets/tiktok-logo.png" alt="–¢—ñ–∫–¢–æ–∫" />
          </a>
        </div>

        <div id="loading" role="status" aria-live="polite">
          <div id="loadingText" aria-live="polite">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: 0%</div>
          <div id="loadingBar"><div id="loadingProgress"></div></div>
        </div>
      </div>
    </div>

    <div id="pvoMenu"></div>

    <div id="alarmIndicator">
      <div class="alarm-dot"></div>
      ‚ö†Ô∏è –ü–æ–≤—Ç–æ—Ä–Ω—ñ –ø—É—Å–∫–∏
    </div>

    <script>
      document.addEventListener(
        'click',
        () => {
          const music = document.getElementById('bgMusic');
          if (music && music.paused) music.play();
        },
        { once: true }
      );

      // –ö–ª–∞–≤—ñ—à—ñ: –ü—Ä–æ–±—ñ–ª ‚Äî –ø–∞—É–∑–∞; 1/2/3 ‚Äî —à–≤–∏–¥–∫—ñ—Å—Ç—å; M ‚Äî –∑–≤—É–∫
      document.addEventListener('keydown', (e) => {
        const pause = document.getElementById('pauseButton');
        const s1 = document.getElementById('speed1x');
        const s2 = document.getElementById('speed2x');
        const s3 = document.getElementById('speed3x');
        const snd = document.getElementById('soundButton');
        if (!pause || !s1 || !s2 || !s3 || !snd) return;
        if (e.key === ' ') {
          e.preventDefault();
          pause.click();
        }
        if (e.key === '1') s1.click();
        if (e.key === '2') s2.click();
        if (e.key === '3') s3.click();
        if (e.key.toLowerCase() === 'm') snd.click();
      });

      // –†–µ—î—Å—Ç—Ä—É—î–º–æ SW –ª–∏—à–µ —É –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ; —É dev (localhost) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥–ø–∏—Å—É–≤–∞–Ω–Ω—è
      (function () {
        if (!('serviceWorker' in navigator)) return;
        const isLocal =
          /^(localhost|127\.0\.0\.1)(:\\d+)?$/.test(location.host) ||
          location.hostname.endsWith('.local');
        if (isLocal) {
          // Dev: –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ —Å–∫–∞—Å–æ–≤—É—î–º–æ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é, —â–æ–± –∫–µ—à –Ω–µ –∑–∞–≤–∞–∂–∞–≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ
          navigator.serviceWorker
            .getRegistrations()
            .then((regs) => regs.forEach((r) => r.unregister()))
            .catch(() => {});
        } else {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js').catch(() => {
              /* ignore */
            });
          });
        }
      })();

      // Pause when tab is hidden (avoid in automated/browser tests)
      if (!('webdriver' in navigator) || !navigator.webdriver) {
        document.addEventListener('visibilitychange', () => {
          const pause = document.getElementById('pauseButton');
          if (document.hidden && pause && pause.textContent !== '‚ñ∂Ô∏è') {
            pause.click();
          }
        });
      }
    </script>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
